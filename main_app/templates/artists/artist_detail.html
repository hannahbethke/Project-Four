{% extends "boilerplate.html" %}


{% block body %}



<div class="main-artist-card">
 <div class="main-artist-photo">
        <img src="{{ artist.image }}">
    </div>
<div class="artist-name">
    <h1>{{artist.name}}</h1>
    <div class="artist-genre">
        <ul>
    {% if artist.genres %}
    {% for genre in artist.genres %}
            <li>{{genre.name}}</li>
    {% endfor %}
    {% else %}
            <li>Genre not found</li>
    {% endif %}
        </ul>
    </div>
</div>
    


<div class="artist-card">
{% if user.is_authenticated %}
{% if profile.fav_artists.count%}
    {% if artist.id in artist_entries %}
    <form action="{% url 'unfollow_artist' artist.id user.id %}" method="post">
        {% csrf_token %}
        <button type="submit" class="">
            Unfollow Artist
        </button>
    </form>
    {% else %}
    <form action="{% url 'follow_or_create_artist' artist.id user.id %}" method="post">
        {% csrf_token %}
        <button type="submit" class="">
            Follow Artist
        </button>
    </form>
    {% endif %}
{% else %}
        <form action="{% url 'follow_or_create_artist' artist.id user.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="">
                Follow Artist
            </button>
        </form>    
{% endif %}
{% endif %}

<div class="card-grid">
                {% for concerts in artist_upcoming_concerts.events %}        
                <div class="card grid-card">
                    <a href="{% url 'detail' concerts.id %}">
                        
                        <img class="card-img-top" src="{{concerts.performers.0.image}}" alt="Image of Artist">
                        <div class="card-body d-flex flex-column">
                        <h4 class="card-title">{{concerts.short_title}}</h4>
                            <h5 class="card-text">{{concerts.venue.name}}</h5>
                            <h5 class="card-text">{{concerts.display_location}}</h5>
                            <h5 id="concert{{concerts.id}}">{{concerts.datetime_local|slice:"0:10"}}</h5>
                        </div>
                    </a>
                </div>
                {% endfor %}

                {% for concerts in artist_upcoming_festivals.events %}
                
                <div class="card grid-card">
                    <a href="{% url 'detail' concerts.id %}">
                        <img class="card-img-top" src="{{concerts.performers.0.image}}" alt="Image of Artist">
                        <div class="card-body d-flex flex-column">
                        <h4 class="card-title">{{concerts.short_title}}</h4>
                            <h5>{{concerts.venue.name}}</h5>
                            <h5>{{concerts.display_location}}</h5>
                            <h5 id="concert{{concerts.id}}">{{concerts.datetime_local|slice:"0:10"}}</h5>
                        </div>
                    </a>
                </div>
                
                {% endfor %}

</div>

<iframe id="spotifyPlayer" style="border-radius:12px" src="https://open.spotify.com/embed/track/{{artist_top_songs.tracks.0.id}}
?utm_source=generator" 
frameBorder="0" allowfullscreen="" 
allow="clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy">
</iframe>

<div class="artist-top-songs">

        <ul id="songs">
{% if artist_top_songs != "" %}
{% for song in artist_top_songs.tracks %}
            <li>
            <button id="{{song.id}}">{{song.name}}</button>
            </li>
{% endfor %}
{% else %}
            <li>No spotify links for the artist found</li>
{% endif %}
        </ul>

    <h2>Genre</h2>
        <ul>
    {% if artist.genres %}
    {% for genre in artist.genres %}
            <li>{{genre.name}}</li>
    {% endfor %}
    {% else %}
            <li>Genre not found</li>
    {% endif %}
        </ul>
    </div>
    </div>

    
    <div class="related-artist-container">
        <h2 class="related-artist-title">Related Artists</h2>
        <div class="horizontal-scroll-wrapper squares">
            <!-- <div class="related-artist-cards"> -->
    {% for artist in artist_related_artists.artists %}
            <!-- <div class="related-artist-card"> -->
                <div>
                <img class="related-artist-image" src="{{ artist.images.0.url }}">
                <p>{{ artist.name }}</p>
                </div>
            <!-- </div> -->
        {% endfor %}
            <!-- </div> -->
        </div>
    </div>
</div>

<script>

    
    document.querySelectorAll('ul#songs > li > button').forEach(
        songs => {
            songs.addEventListener('click', () => {
                document.getElementById('spotifyPlayer').src = `https://open.spotify.com/embed/track/${songs.id}?utm_source=generator`
            })
        }
    )
    
</script>

{% endblock %}